<main class="flex-grow container mx-auto px-4 py-4 mt-0">
    <div class="bg-white px-6 pt-2 rounded-t-lg shadow-md">
        <h1 id="active-project-title" class="text-2xl font-bold text-gray-800 mb-2">Projet sélectionné</h1>

        {% if projects %}
                <!-- Project Information Section -->
                <div class="bg-white p-4 rounded-lg border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Information du projet</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- First column of form fields -->
                        <div class="grid grid-cols-1 md:grid-cols-2">

                            <div>
                                <label for="architect-file" class="block text-sm font-medium text-gray-700">Dossier Architecte</label>
                                <input type="text" id="architect-file" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>

                            <div>
                                <label for="project-name" class="block text-sm font-medium text-gray-700">Projet</label>
                                <input type="text" id="project-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>

                            <div>
                                <label for="project-owner" class="block text-sm font-medium text-gray-700">Maitre de l'ouvrage</label>
                                <input type="text" id="project-owner" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>

                            <div>
                                <label for="contractor" class="block text-sm font-medium text-gray-700">Entrepreneur</label>
                                <input type="text" id="contractor" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>

                            <div>
                                <label for="visit-number" class="block text-sm font-medium text-gray-700">Visite no.</label>
                                <input type="text" id="visit-number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>

                            <div>
                                <label for="visit-by" class="block text-sm font-medium text-gray-700">Visite effectuée par</label>
                                <input type="text" id="visit-by" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>

                            <div>
                                <label for="in-presence-of" class="block text-sm font-medium text-gray-700">En présence de</label>
                                <input type="text" id="in-presence-of" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>

                             <div>
                                <label for="visit-date" class="block text-sm font-medium text-gray-700">Le</label>
                                <input type="date" id="visit-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>

                             <div>
                                <label for="report-date" class="block text-sm font-medium text-gray-700">Date du rapport</label>
                                <input type="date" id="report-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>

                        </div>


                        <!-- Second column of form fields -->
                        <div class="space-y-4">
                            <!-- Project Image Upload at the top of second column -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Image du projet</label>
                                <div class="mt-1">
                                    <div id="project-image-preview" class="w-full h-60 bg-gray-100 flex items-center justify-center border border-gray-300 rounded-md overflow-hidden">
                                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                    <button type="button" id="upload-image-btn" class="mt-2 w-full bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm leading-4 font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        Upload
                                    </button>
                                    <input type="file" id="project-image-upload" accept="image/*" class="hidden">
                                </div>
                            </div>

                            <!-- Data persistence status -->
                            <div id="data-status" class="mt-4 hidden">
                                <div class="p-2 rounded-md bg-blue-50 text-blue-800 text-sm">
                                    <span id="last-saved-text">Chargement des données</span>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Project Description -->
                    <div class="mt-1">
                        <label for="project-description" class="block text-sm font-medium text-gray-700">Description du projet</label>
                        <textarea id="project-description" rows="3" class="resize-none mt-1 block w-full h-20 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                    </div>

                    <div>
                        <label for="distribution" class="block text-sm font-medium text-gray-700">Distribution</label>
                        <textarea type="text" id="distribution" class="resize-none mt-1 h-45 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- Save Button -->
                    <div class="mt-1 flex space-x-4">
                        <button type="button" id="save-project-info" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Enregistrer
                        </button>
                        <button type="button" id="clear-project-info" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                            Tout supprimer
                        </button>
                        <button type="button" id="generate-pdf" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                            Générer PDF
                         </button>
                    </div>
                </div>
        {% else %}
            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                <p class="text-yellow-700">No projects found. Please check your API connection.</p>
            </div>
        {% endif %}
    </div>

<hr class="w-[95%] h-1.5 bg-black border-0 mx-auto mt-[-0.75rem] relative z-10" />

    <!-- General notes -->
    <div class="bg-white p-6 shadow-md ">
        {% if projects %}
            <div class="gap-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Notes générales</h2>

                <div class=" p-4 grid-cols-1">

                    <p class="text-gray-700 font-medium ">A. Observations</p>
                    <div class="prose prose-sm text-gray-600">
                        <p class="text-gray-700 font-medium">Généralités : </p> <p> Les éléments listés ci-dessous documentent l’état général d’avancement du chantier et ils ne nécessitent donc aucun suivi de la part de l’Entrepreneur.</p>
                    </div>

                    <p class="text-gray-700 font-medium mt-4">B. Instructions</p>
                    <div class="prose prose-sm text-gray-600">
                        <p class="text-gray-700 font-medium ">Généralités : </p><p> Les éléments listés ci-dessous documentent les instructions données à l’Entrepreneur et ils nécessitent donc un suivi de sa part.</p>
                    </div>

                    <p class="text-gray-700 font-medium mt-4">C. Déficiences</p>
                    <div class="prose prose-sm text-gray-600">
                        <p class="text-gray-700 font-medium ">Généralités : </p><p>La liste de Déficiences ci-dessous est non-limitative et ne relève pas l'Entrepreneur et ses Soustraitants
de leurs responsabilités de se conformer aux exigences des plans, devis et autres Documents contractuels
et notamment en ce qui concerne la complétion de l'Ouvrage. En outre, elle doit être complétée par celles des
autres Professionnels concernés.</p>
                        <p class="text-gray-700 font-medium mt-2">Procédure : </p><p>Les Déficiences doivent être corrigés dans les dix (10) jours ouvrables suivant la réception du présent
document. Le surintendant de l'Entrepreneur doit traiter les Déficiences sur cette liste et la faire suivre à l'Architecte
dès que les travaux correctifs ont été effectués. Aucune retenue monétaire ne sera libérée tant et aussi longtemps
que les Déficiences n’auront été entièrement et
parfaitement corrigées.</p>
                        <p class="text-gray-700 font-medium mt-2">Honoraires supplémentaires : </p><p>Après la Réception provisoire de l’ouvrage, l’Architecte prévoit une seule visite
pour procéder à l'acceptation finale des travaux correctifs et il facturera, au Maître de l’ouvrage, des honoraires
supplémentaires de 1 000 $/visite supplémentaire. Le montant total des honoraires supplémentaire sera prélevé
par le Maître de l’ouvrage à même les sommes dues à
l'Entrepreneur en vertu de son Contrat. L'Entrepreneur est responsable de s'assurer que toutes les Déficiences,
incluant celles de ses Sous-traitants et de ses Fournisseurs, ont bel et bien été
entièrement et parfaitement corrigées. </p>
                        <p class="text-gray-700 font-medium mt-2">Classement des couleurs des pastilles : </p><p> Bleu (posée) : nouvelle observation/instruction/déficience constatée par l'Architecte.</p>
                                                                                                               <p>  Rouge / orange (posée) : observation/instruction/déficience d'une visite précédente.</p>
                                                                                                             <p>    Mauve (traitée) : déficience traitée par l'entrepreneur, prête à être validée par l'Architecte.</p>
                                                                                                              <p>   Noir (refusée) : correction de déficience refusée par l'Architecte, à corriger de nouveau, adéquatement.</p>
                                                                                                              <p>   Gris (levée) : déficience dont la correction est approuvée par l'Architecte.</p>
                    </div>

                </div>
            </div>
        {% else %}
             <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
            </div>
        {% endif %}
    </div>

    <hr class="w-[95%] h-1.5 bg-black border-0 mx-auto mt-[-0.75rem] relative z-10" />

    <!-- Observations -->
    <div class="bg-white p-6 shadow-md">
        <h2 class="text-2xl font-bold text-gray-800 mb-1">1 - Observations</h2>
        <div id="observations-container" class="mt-1">
            <p class="text-gray-600">Sélectionnez un projet pour voir les observations.</p>
        </div>
    </div>

    <hr class="w-[95%] h-1.5 bg-black border-0 mx-auto mt-[-0.75rem] relative z-10" />

    <!-- instructions -->
    <div class="bg-white p-6 shadow-md">
        <h2 class="text-2xl font-bold text-gray-800 mb-1">2 - Instructions</h2>
        <div id="instructions-container" class="mt-1">
            <p class="text-gray-600">Sélectionnez un projet pour voir les instructions.</p>
        </div>
    </div>

    <hr class="w-[95%] h-1.5 bg-black border-0 mx-auto mt-[-0.75rem] relative z-10" />

    <!-- Déficiences -->
    <div class="bg-white p-6 rounded-b-lg shadow-md">
        <h2 class="text-2xl font-bold text-gray-800 mb-1">3 - Déficiences</h2>
        <div id="deficiencies-container" class="mt-1">
            <p class="text-gray-600">Sélectionnez un projet pour voir les déficiences.</p>
        </div>
    </div>

</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded - main.html script running');

        // Add event listener for image upload button
        const uploadBtn = document.getElementById('upload-image-btn');
        const fileInput = document.getElementById('project-image-upload');
        const imagePreview = document.getElementById('project-image-preview');

        if (uploadBtn && fileInput) {
            uploadBtn.addEventListener('click', () => {
                fileInput.click();
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // Clear previous content
                        imagePreview.innerHTML = '';

                        // Create and append image
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'w-full h-full object-cover';
                        imagePreview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    })

</script>